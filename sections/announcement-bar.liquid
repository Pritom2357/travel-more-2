{{ 'component-slideshow.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign social_icons = false
  if settings.social_facebook_link != blank or settings.social_instagram_link != blank or settings.social_youtube_link != blank or settings.social_tiktok_link != blank or settings.social_twitter_link != blank or settings.social_pinterest_link != blank
    assign social_icons = true
  endif
  
  assign language_country_selector = false
  if section.settings.enable_country_selector or section.settings.enable_language_selector
    assign language_country_selector = true
  endif
  
  assign announcement_bar = false
  if section.blocks.size > 0
    assign announcement_bar = true
  endif
-%}

{% if social_icons %}
  {{ 'component-list-social.css' | asset_url | stylesheet_tag }}
{% endif %}

<div class="utility-bar color-{{ section.settings.color_scheme }} gradient{% if section.settings.show_line_separator and section.blocks.size > 0 %} utility-bar--bottom-border{% elsif section.settings.show_line_separator and section.settings.show_social and social_icons%} utility-bar--bottom-border-social-only{% endif %}{% if section.settings.enable_country_selector or section.settings.enable_language_selector %} header-localization{% endif %}">
  <div class="page-width utility-bar__grid{% if announcement_bar and language_country_selector or section.settings.show_social and social_icons %} utility-bar__grid--3-col{% elsif language_country_selector or section.settings.show_social and social_icons %} utility-bar__grid--2-col{% endif %}">
    
    {%- if section.settings.show_social and social_icons -%}
      {%- render 'social-icons' -%}
    {%- endif -%}
    
    {%- if section.blocks.size == 1 -%}
      <div class="announcement-bar{% if section.settings.show_social %} announcement-bar--one-announcement{% endif %}" role="region" aria-label="Announcement">
        {%- assign block = section.blocks.first -%}
        {%- if block.settings.text != blank -%}
          {%- if block.settings.link != blank -%}
            <a href="{{ block.settings.link }}" class="announcement-bar__link link link--text focus-inset animate-arrow">
          {%- endif -%}
          <p class="announcement-bar__message h5">
            <span>{{ block.settings.text | escape }}</span>
            {%- if block.settings.link != blank -%}
              <svg class="icon icon-arrow" aria-hidden="true" focusable="false" viewBox="0 0 14 10">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M8.537.808a.5.5 0 01.817-.162l4 4a.5.5 0 010 .708l-4 4a.5.5 0 11-.708-.708L11.793 5.5H1a.5.5 0 010-1h10.793L8.646 1.354a.5.5 0 01-.109-.546z" fill="currentColor">
              </svg>
            {%- endif -%}
          </p>
          {%- if block.settings.link != blank -%}
            </a>
          {%- endif -%}
        {%- endif -%}
      </div>
    {%- elsif section.blocks.size > 1 -%}
      <slideshow-component class="announcement-bar" role="region" aria-roledescription="Carousel" aria-label="Announcement bar">
        <div class="announcement-bar-slider slider-buttons">
          <button type="button" class="slider-button slider-button--prev" name="previous" aria-label="Previous announcement" aria-controls="Slider-{{ section.id }}">
            <svg aria-hidden="true" focusable="false" class="icon icon-caret" viewBox="0 0 10 6">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor">
            </svg>
          </button>
          
          <div class="grid grid--1-col slider slider--everywhere" id="Slider-{{ section.id }}" aria-live="polite" aria-atomic="true" data-autoplay="{{ section.settings.auto_rotate }}" data-speed="{{ section.settings.change_slides_speed }}">
            {%- for block in section.blocks -%}
              <div class="slideshow__slide slider__slide grid__item grid--1-col{% if forloop.first %} slider__slide--active{% endif %}" id="Slide-{{ section.id }}-{{ forloop.index }}" {{ block.shopify_attributes }} role="group" aria-roledescription="Announcement" aria-label="{{ forloop.index }} of {{ forloop.length }}" tabindex="-1">
                <div class="announcement-bar__announcement" role="region" aria-label="Announcement">
                  {%- if block.settings.text != blank -%}
                    {%- if block.settings.link != blank -%}
                      <a href="{{ block.settings.link }}" class="announcement-bar__link link link--text focus-inset animate-arrow">
                    {%- endif -%}
                    <p class="announcement-bar__message h5">
                      <span>{{ block.settings.text | escape }}</span>
                      {%- if block.settings.link != blank -%}
                        <svg class="icon icon-arrow" aria-hidden="true" focusable="false" viewBox="0 0 14 10">
                          <path fill-rule="evenodd" clip-rule="evenodd" d="M8.537.808a.5.5 0 01.817-.162l4 4a.5.5 0 010 .708l-4 4a.5.5 0 11-.708-.708L11.793 5.5H1a.5.5 0 010-1h10.793L8.646 1.354a.5.5 0 01-.109-.546z" fill="currentColor">
                        </svg>
                      {%- endif -%}
                    </p>
                    {%- if block.settings.link != blank -%}
                      </a>
                    {%- endif -%}
                  {%- endif -%}
                </div>
              </div>
            {%- endfor -%}
          </div>
          
          <button type="button" class="slider-button slider-button--next" name="next" aria-label="Next announcement" aria-controls="Slider-{{ section.id }}">
            <svg aria-hidden="true" focusable="false" class="icon icon-caret" viewBox="0 0 10 6">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor">
            </svg>
          </button>
        </div>
      </slideshow-component>
    {%- endif -%}
    
    <div class="localization-wrapper">
      {%- if section.settings.enable_country_selector and localization.available_countries.size > 1 -%}
        <div class="localization-form">
          {%- form 'localization', id: 'AnnouncementCountryForm', class: 'localization-form' -%}
            <div>
              <h2 class="visually-hidden" id="AnnouncementCountryLabel">Country/Region</h2>
              {%- render 'country-localization', localPosition: 'AnnouncementCountry' -%}
            </div>
          {%- endform -%}
        </div>
      {% endif %}

      {%- if section.settings.enable_language_selector and localization.available_languages.size > 1 -%}
        <div class="localization-form">
          {%- form 'localization', id: 'AnnouncementLanguageForm', class: 'localization-form' -%}
            <div>
              <h2 class="visually-hidden" id="AnnouncementLanguageLabel">Language</h2>
              {%- render 'language-localization', localPosition: 'AnnouncementLanguage' -%}
            </div>
          {%- endform -%}
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

<style>
.utility-bar {
  padding: 0.8rem 0;
  text-align: center;
  position: relative;
  z-index: 3;
}

.utility-bar--bottom-border {
  border-bottom: 0.1rem solid rgba(var(--color-foreground), 0.08);
}

.page-width {
  max-width: 120rem;
  margin: 0 auto;
  padding: 0 1.5rem;
}

.utility-bar__grid {
  display: grid;
  grid-template-columns: 1fr;
  align-items: center;
  justify-content: center;
  gap: 1rem;
}

.utility-bar__grid--2-col {
  grid-template-columns: auto 1fr;
}

.utility-bar__grid--3-col {
  grid-template-columns: auto 1fr auto;
}

.announcement-bar {
  display: flex;
  align-items: center;
  justify-content: center;
}

.announcement-bar__message {
  margin: 0;
  font-size: 1.4rem;
  line-height: 1.3;
  font-weight: 500;
}

.announcement-bar__link {
  display: inline-flex;
  align-items: center;
  text-decoration: none;
  color: currentColor;
  gap: 0.5rem;
}

.announcement-bar__link:hover {
  text-decoration: underline;
}

.icon {
  width: 1.2rem;
  height: 1.2rem;
  fill: currentColor;
}

.slider-button {
  background: transparent;
  border: none;
  color: currentColor;
  cursor: pointer;
  padding: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.slider-button:hover {
  opacity: 0.7;
}

.announcement-bar-slider {
  display: flex;
  align-items: center;
  gap: 1rem;
  width: 100%;
  justify-content: center;
}

.announcement-bar-slider .slider {
  overflow: hidden;
  min-width: 0;
}

.visually-hidden {
  position: absolute !important;
  overflow: hidden;
  width: 1px;
  height: 1px;
  margin: -1px;
  padding: 0;
  border: 0;
  clip: rect(0 0 0 0);
  word-wrap: normal;
}

.localization-wrapper {
  display: flex;
  gap: 1rem;
  align-items: center;
}

/* Color scheme support */
.color-scheme-1 {
  background-color: rgb(var(--color-background));
  color: rgb(var(--color-foreground));
}

.color-scheme-2 {
  background-color: #f3f3f3;
  color: #121212;
}

.color-scheme-3 {
  background-color: #121212;
  color: #ffffff;
}

.color-scheme-4 {
  background-color: #18181b;
  color: #ffffff;
}

.color-scheme-5 {
  background-color: #fef7f0;
  color: #633a00;
}

@media screen and (max-width: 749px) {
  .utility-bar__grid--3-col,
  .utility-bar__grid--2-col {
    grid-template-columns: 1fr;
    gap: 0.5rem;
  }
  
  .announcement-bar__message {
    font-size: 1.2rem;
  }
}
</style>

<script>
if (typeof slideshow === 'undefined') {
  class SlideShowComponent extends HTMLElement {
    constructor() {
      super();
      this.currentSlide = 0;
      this.slides = this.querySelectorAll('.slider__slide');
      this.totalSlides = this.slides.length;
      
      if (this.totalSlides > 1) {
        this.setupSlideshow();
      }
    }
    
    setupSlideshow() {
      const prevButton = this.querySelector('.slider-button--prev');
      const nextButton = this.querySelector('.slider-button--next');
      const autoplay = this.querySelector('.slider').dataset.autoplay === 'true';
      const speed = parseInt(this.querySelector('.slider').dataset.speed) * 1000 || 5000;
      
      if (prevButton) {
        prevButton.addEventListener('click', () => this.previousSlide());
      }
      
      if (nextButton) {
        nextButton.addEventListener('click', () => this.nextSlide());
      }
      
      if (autoplay) {
        this.startAutoplay(speed);
      }
      
      this.showSlide(0);
    }
    
    showSlide(index) {
      this.slides.forEach((slide, i) => {
        slide.classList.toggle('slider__slide--active', i === index);
      });
      this.currentSlide = index;
    }
    
    nextSlide() {
      const next = (this.currentSlide + 1) % this.totalSlides;
      this.showSlide(next);
    }
    
    previousSlide() {
      const prev = (this.currentSlide - 1 + this.totalSlides) % this.totalSlides;
      this.showSlide(prev);
    }
    
    startAutoplay(interval) {
      setInterval(() => {
        this.nextSlide();
      }, interval);
    }
  }
  
  customElements.define('slideshow-component', SlideShowComponent);
}
</script>

{% schema %}
{
  "name": "Announcement bar",
  "max_blocks": 12,
  "class": "announcement-bar-section",
  "enabled_on": {
    "groups": ["header"]
  },
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-4"
    },
    {
      "type": "checkbox",
      "id": "show_line_separator",
      "default": true,
      "label": "Show line separator"
    },
    {
      "type": "header",
      "content": "Social media icons"
    },
    {
      "type": "checkbox",
      "id": "show_social",
      "default": false,
      "label": "Show social media icons"
    },
    {
      "type": "header",
      "content": "Auto-rotate content"
    },
    {
      "type": "checkbox",
      "id": "auto_rotate",
      "label": "Auto-rotate content",
      "default": false
    },
    {
      "type": "range",
      "id": "change_slides_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Change slides every",
      "default": 5
    },
    {
      "type": "header",
      "content": "Country/Region Selector"
    },
    {
      "type": "checkbox",
      "id": "enable_country_selector",
      "default": false,
      "label": "Enable country/region selector"
    },
    {
      "type": "header",
      "content": "Language Selector"
    },
    {
      "type": "checkbox",
      "id": "enable_language_selector",
      "default": false,
      "label": "Enable language selector"
    }
  ],
  "blocks": [
    {
      "type": "announcement",
      "name": "Announcement",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "default": "Welcome to our store",
          "label": "Text"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Announcement bar",
      "blocks": [
        {
          "type": "announcement"
        }
      ]
    }
  ]
}
{% endschema %}
