<section id="happy-travelers" class="traveler-reviews-section">
  <div class="container">
    <!-- Section Title -->
    {% if section.settings.section_title != blank %}
      <h2 class="section-title">{{ section.settings.section_title }}</h2>
    {% endif %}

    <div class="reviews-container">
      <!-- Hero Image -->
      {% if section.settings.hero_image != blank %}
        <div class="hero-image-container">
          <img
            src="{{ section.settings.hero_image | img_url: '600x' }}"
            alt="Traveler experiences"
            class="hero-image"
          >
        </div>
      {% endif %}

      <!-- Slideshow Container -->
      <div class="slideshow-container">
        {% for block in section.blocks %}
          {% if block.type == 'review' %}
            <div class="review-slide fade" data-slide-index="{{ forloop.index0 }}">
              <div class="review-content">
                <!-- Traveler Image -->
                {% if block.settings.traveler_image != blank %}
                  <div class="traveler-image-container">
                    <img 
                      src="{{ block.settings.traveler_image | img_url: '200x200', crop: 'center' }}" 
                      alt="{{ block.settings.name }}"
                      class="traveler-image"
                    >
                  </div>
                {% endif %}
                
                <div class="review-details">
                  <!-- Rating Stars -->
                  <div class="rating-stars">
                    {% assign rating = block.settings.rating | default: 0 %}
                    {% assign filled_stars = rating | floor %}
                    {% assign empty_stars = 5 | minus: filled_stars %}

                    {% for star in (1..filled_stars) %}
                      <i class="bi bi-star-fill"></i>
                    {% endfor %}
                    {% for star in (1..empty_stars) %}
                      <i class="bi bi-star"></i>
                    {% endfor %}
                  </div>

                  <!-- Review Title -->
                  <h3 class="review-title">{{ block.settings.title }}</h3>

                  <!-- Author and Date -->
                  <p class="review-meta">
                    <strong>{{ block.settings.name }}</strong> &nbsp; | &nbsp;
                    {{ block.settings.date }}
                  </p>

                  <!-- Review Text -->
                  <p class="review-text">{{ block.settings.text }}</p>
                </div>
              </div>
            </div>
          {% endif %}
        {% endfor %}

        <!-- Navigation Buttons -->
        <button class="prev-btn" onclick="changeSlide(-1)">❮</button>
        <button class="next-btn" onclick="changeSlide(1)">❯</button>
      </div>

      <!-- Dots Navigation -->
      <div class="dots-container">
        {% for block in section.blocks %}
          {% if block.type == 'review' %}
            <span class="dot" onclick="jumpToSlide({{ forloop.index0 }})"></span>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>

  <style>
    .traveler-reviews-section {
      padding: 3rem 1rem;
      background-color: #f9f9f9;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .section-title {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 2rem;
      color: #333;
    }

    .reviews-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2rem;
    }

    .hero-image-container {
      width: 100%;
      max-width: 400px;
      text-align: center;
    }

    .hero-image {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    /* Slideshow Container */
    .slideshow-container {
      position: relative;
      width: 100%;
      max-width: 700px;
      margin: 0 auto;
    }

    /* Hide slides by default */
    .review-slide {
      display: none;
      background-color: white;
      border-radius: 10px;
      padding: 2rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      text-align: center;
      min-height: 250px;
    }

    /* Active slide */
    .review-slide.active {
      display: block;
    }

    /* Star Rating */
    .rating-stars {
      color: #f39c12;
      font-size: 1.2rem;
      margin-bottom: 1rem;
    }

    /* Review Content */
    .review-title {
      font-size: 1.4rem;
      margin-bottom: 0.75rem;
      color: #333;
    }

    .review-meta {
      font-size: 0.9rem;
      color: #777;
      margin-bottom: 1.5rem;
    }

    .review-text {
      font-size: 1.1rem;
      line-height: 1.6;
      color: #555;
      font-style: italic;
    }

    /* Navigation Buttons */
    .prev-btn, .next-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background-color: rgba(255, 255, 255, 0.7);
      color: #333;
      border: none;
      padding: 15px;
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .prev-btn {
      left: -25px;
    }

    .next-btn {
      right: -25px;
    }

    .prev-btn:hover, .next-btn:hover {
      background-color: rgba(0,0,0,0.1);
    }

    /* Dots Navigation */
    .dots-container {
      text-align: center;
      margin-top: 1.5rem;
    }

    .dot {
      display: inline-block;
      height: 12px;
      width: 12px;
      margin: 0 5px;
      background-color: #bbb;
      border-radius: 50%;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .dot.active {
      background-color: #717171;
    }

    /* Animation */
    .fade {
      animation-name: fade;
      animation-duration: 0.5s;
    }

    @keyframes fade {
      from {opacity: 0.4}
      to {opacity: 1}
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .prev-btn, .next-btn {
        padding: 10px;
        font-size: 16px;
      }
      
      .review-slide {
        padding: 1.5rem;
      }
      
      .review-title {
        font-size: 1.2rem;
      }
      
      .review-text {
        font-size: 1rem;
      }
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize the slideshow
      let slideIndex = 0;
      const slides = document.querySelectorAll('.review-slide');
      const dots = document.querySelectorAll('.dot');
      
      // Show the first slide
      if (slides.length > 0) {
        showSlide(slideIndex);
      }
      
      // Make the functions available globally
      window.changeSlide = function(n) {
        showSlide(slideIndex += n);
      };
      
      window.jumpToSlide = function(n) {
        showSlide(slideIndex = n);
      };
      
      function showSlide(n) {
        // Reset index if out of bounds
        if (n >= slides.length) {slideIndex = 0}
        if (n < 0) {slideIndex = slides.length - 1}
        
        // Hide all slides
        for (let i = 0; i < slides.length; i++) {
          slides[i].style.display = "none";
          dots[i].classList.remove('active');
        }
        
        // Show the current slide
        slides[slideIndex].style.display = "block";
        dots[slideIndex].classList.add('active');
      }
      
      // Auto-advance slides every 5 seconds
      setInterval(function() {
        changeSlide(1);
      }, 5000);
    });
  </script>
</section>

{% schema %}
{
  "name": "Travelers Reviews",
  "settings": [
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Happy Travelers"
    },
    {
      "type": "image_picker",
      "id": "hero_image",
      "label": "Hero Image",
      "info": "Upload or select an image to display with the reviews."
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Section Background Color",
      "default": "#f9f9f9"
    },
    {
      "type": "color",
      "id": "star_color",
      "label": "Star Rating Color",
      "default": "#f39c12"
    }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review",
      "settings": [
        {
          "id": "name",
          "type": "text",
          "label": "Reviewer Name",
          "default": "Howard Reed"
        },
        {
          "id": "date",
          "type": "text",
          "label": "Review Date",
          "default": "2023-05-15"
        },
        {
          "type": "range",
          "id": "rating",
          "label": "Star Rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5
        },
        {
          "id": "title",
          "type": "text",
          "label": "Review Title",
          "default": "The planning process was excellent"
        },
        {
          "id": "text",
          "type": "textarea",
          "label": "Review Text",
          "default": "It was a life changing experience and we couldn't be happier to have done it. The accommodations were excellent and the guides were knowledgeable and friendly."
        },
        {
          "id": "traveler_image",
          "type": "image_picker",
          "label": "Traveler Image",
          "info": "Upload or select an image of the traveler."
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "Happy Travelers Reviews",
      "blocks": [
        {
          "type": "review"
        },
        {
          "type": "review"
        },
        {
          "type": "review"
        }
      ]
    }
  ]
}
{% endschema %}
