<section class="related-products-section">
  <div class="container">
    <h2>{{ section.settings.heading }}</h2>
    
    <div class="related-products-grid">
      {%- assign related_limit = section.settings.products_to_show | default: 4 -%}
      {%- assign related_collection = product.collections.first -%}
      
      {% if related_collection %}
        {%- assign related_products = related_collection.products | where: "id", "<>" | limit: related_limit -%}
        
        {% for related_product in related_collection.products limit: related_limit %}
          {% if related_product.id != product.id %}
            <div class="related-product-card">
              <a href="{{ related_product.url }}">
                <div class="related-product-image">
                  {% if related_product.featured_image %}
                    <img src="{{ related_product.featured_image | img_url: '300x300', crop: 'center' }}" alt="{{ related_product.featured_image.alt | escape }}">
                  {% else %}
                    <div class="placeholder-image">{{ related_product.title | truncate: 2 }}</div>
                  {% endif %}
                </div>
                <h3>{{ related_product.title }}</h3>
                <p class="price">{{ related_product.price | money }}</p>
              </a>
            </div>
          {% endif %}
        {% endfor %}
      {% endif %}
    </div>
  </div>
  
  <style>
    .related-products-section {
      padding: 60px 0;
      background-color: #f9f9f9;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .related-products-section h2 {
      text-align: center;
      margin-bottom: 40px;
      font-size: 28px;
      color: #333;
    }
    
    .related-products-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 30px;
    }
    
    .related-product-card {
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .related-product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    }
    
    .related-product-card a {
      display: block;
      text-decoration: none;
      color: inherit;
    }
    
    .related-product-image {
      height: 200px;
      overflow: hidden;
    }
    
    .related-product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s;
    }
    
    .related-product-card:hover .related-product-image img {
      transform: scale(1.05);
    }
    
    .placeholder-image {
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f0f0f0;
      color: #999;
      font-size: 2rem;
    }
    
    .related-product-card h3 {
      padding: 15px 15px 5px;
      font-size: 16px;
      margin: 0;
    }
    
    .price {
      padding: 0 15px 15px;
      font-weight: bold;
      color: #4a90e2;
    }
    
    @media (max-width: 991px) {
      .related-products-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (max-width: 767px) {
      .related-products-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 479px) {
      .related-products-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</section>

{% schema %}
{
  "name": "Related Products",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "You may also like"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 10,
      "step": 1,
      "default": 4,
      "label": "Products to show"
    }
  ]
}
{% endschema %}