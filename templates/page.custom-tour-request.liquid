<div class="custom-tour-container">
  <div class="page-header">
    <div class="container">
      <h1>{{ page.title | default: 'Request a Custom Tour' }}</h1>
      
      <div class="page-description">
        {% if page.content != blank %}
          <div class="page-custom-content">
            {{ page.content }}
          </div>
        {% endif %}
        
        <p class="default-message">Can't find exactly what you're looking for? Let us design a custom tour tailored to your preferences, group size, and schedule. Fill out the form below and our travel experts will get back to you within 24 hours.</p>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-lg-8 offset-lg-2">
        <div class="custom-tour-form-container">
          <form id="customTourRequestForm" class="custom-tour-form" action="/contact#contact_form" method="post">
            <input type="hidden" name="form_type" value="contact">
            <input type="hidden" name="utf8" value="✓">
            {% if form.posted_successfully? %}
              <div class="form-success alert alert-success">
                <i class="bi bi-check-circle-fill"></i>
                <span>Thank you for your custom tour request! We'll get back to you within 24 hours.</span>
              </div>
            {% endif %}
            
            {% if form.errors %}
              <div class="form-error alert alert-danger">
                <i class="bi bi-exclamation-triangle-fill"></i>
                <span>There was an error submitting your request. Please check the form and try again.</span>
              </div>
            {% endif %}
            
            <div class="form-section">
              <h3>Destination Details</h3>
              
              <div class="form-group">
                <label for="destination">Where would you like to go? <span class="required">*</span></label>
                <input 
                  type="text" 
                  id="destination" 
                  name="contact[Destination]" 
                  class="form-control" 
                  required 
                  value="{{ request.params.destination }}"
                  placeholder="e.g., Paris, France or Southeast Asia tour">
              </div>
              
              <div class="form-group">
                <label for="destination-details">Describe your ideal destination and activities <span class="required">*</span></label>
                <textarea 
                  id="destination-details" 
                  name="contact[Destination Details]" 
                  class="form-control" 
                  rows="4" 
                  required
                  placeholder="Let us know about specific places you want to visit, activities you're interested in, or any special requirements"></textarea>
              </div>
            </div>
            
            <div class="form-section">
              <h3>Travel Information</h3>
              
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="start-date">Preferred Start Date <span class="required">*</span></label>
                  <input 
                    type="date" 
                    id="start-date" 
                    name="contact[Start Date]" 
                    class="form-control" 
                    required 
                    value="{{ request.params.date }}"
                    min="{{ 'now' | date: '%Y-%m-%d' }}">
                </div>
                
                <div class="form-group col-md-6">
                  <label for="duration">Duration (days) <span class="required">*</span></label>
                  <input 
                    type="number" 
                    id="duration" 
                    name="contact[Duration]" 
                    class="form-control" 
                    required 
                    value="{{ request.params.duration | default: 7 }}"
                    min="1" 
                    max="90">
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="travelers">Number of Travelers <span class="required">*</span></label>
                  <input 
                    type="number" 
                    id="travelers" 
                    name="contact[Travelers]" 
                    class="form-control" 
                    required 
                    value="{{ request.params.travelers | default: 2 }}"
                    min="1" 
                    max="50">
                </div>
                
                <div class="form-group col-md-6">
                  <label for="budget">Approximate Budget per Person</label>
                  <select id="budget" name="contact[Budget]" class="form-control">
                    <option value="Not specified">Not specified</option>
                    <option value="Economy ($1000-$2500)">Economy ($1000-$2500)</option>
                    <option value="Standard ($2500-$5000)">Standard ($2500-$5000)</option>
                    <option value="Premium ($5000-$10000)">Premium ($5000-$10000)</option>
                    <option value="Luxury ($10000+)">Luxury ($10000+)</option>
                  </select>
                </div>
              </div>
              
              <div class="form-group">
                <label for="special-requests">Special Requests or Requirements</label>
                <textarea 
                  id="special-requests" 
                  name="contact[Special Requests]" 
                  class="form-control" 
                  rows="3"
                  placeholder="Dietary restrictions, accessibility needs, preferred accommodations, etc."></textarea>
              </div>
            </div>
            
            <div class="form-section">
              <h3>Contact Information</h3>
              
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="name">Full Name <span class="required">*</span></label>
                  <input type="text" id="name" name="contact[name]" class="form-control" required>
                </div>
                
                <div class="form-group col-md-6">
                  <label for="email">Email Address <span class="required">*</span></label>
                  <input type="email" id="email" name="contact[email]" class="form-control" required>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="phone">Phone Number</label>
                  <input type="tel" id="phone" name="contact[phone]" class="form-control">
                </div>
                
                <div class="form-group col-md-6">
                  <label for="preferred-contact">Preferred Contact Method</label>
                  <select id="preferred-contact" name="contact[Preferred Contact]" class="form-control">
                    <option value="Email">Email</option>
                    <option value="Phone">Phone</option>
                  </select>
                </div>
              </div>
              
              <div class="form-group">
                <label class="custom-control custom-checkbox">
                  <input type="checkbox" name="contact[Newsletter Signup]" class="custom-control-input">
                  <span class="custom-control-indicator"></span>
                  <span class="custom-control-description">Sign me up for travel deals and inspiration (optional)</span>
                </label>
              </div>
            </div>
              <div class="form-actions">
              <p class="form-note"><span class="required">*</span> Required fields</p>
              <button type="submit" class="btn btn-primary btn-lg submit-btn" aria-label="Submit custom tour request">
                <i class="bi bi-send"></i> Submit Request
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <div class="container mt-5">
    <div class="why-custom-tour">
      <h2 class="text-center mb-4">Why Book a Custom Tour?</h2>
      
      <div class="row features">
        <div class="col-md-4 feature">
          <div class="feature-icon">
            <i class="bi bi-map"></i>
          </div>
          <h4>Personalized Itinerary</h4>
          <p>Visit only the places you want to see and skip what doesn't interest you. Your tour, your way.</p>
        </div>
        
        <div class="col-md-4 feature">
          <div class="feature-icon">
            <i class="bi bi-calendar-check"></i>
          </div>
          <h4>Flexible Scheduling</h4>
          <p>Travel when it's convenient for you. Set your own pace without being rushed through attractions.</p>
        </div>
        
        <div class="col-md-4 feature">
          <div class="feature-icon">
            <i class="bi bi-people"></i>
          </div>
          <h4>Private Experience</h4>
          <p>Travel with just your group. Enjoy personalized attention from guides and exclusive experiences.</p>
        </div>
      </div>
    </div>
  </div>
  
  <div class="container mt-5 mb-5">
    <div class="custom-tour-faq">
      <h2 class="text-center mb-4">Frequently Asked Questions</h2>
      
      <div class="accordion" id="customTourFaq">
        <div class="card">
          <div class="card-header" id="faqOne">            <h5 class="mb-0">
              <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne" aria-label="Toggle FAQ about response time">
                How quickly will I receive a response to my custom tour request?
              </button>
            </h5>
          </div>
          <div id="collapseOne" class="collapse show" aria-labelledby="faqOne" data-parent="#customTourFaq">
            <div class="card-body">
              Our travel experts will typically respond within 24 business hours with an initial proposal or to gather additional information.
            </div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header" id="faqTwo">            <h5 class="mb-0">
              <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo" aria-label="Toggle FAQ about tour pricing">
                Is there a fee for requesting a custom tour?
              </button>
            </h5>
          </div>
          <div id="collapseTwo" class="collapse" aria-labelledby="faqTwo" data-parent="#customTourFaq">
            <div class="card-body">
              No, requesting a custom tour and receiving a proposal is completely free. You'll only pay if you decide to book the tour.
            </div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header" id="faqThree">            <h5 class="mb-0">
              <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree" aria-label="Toggle FAQ about modifying proposals">
                Can I modify the proposal once I receive it?
              </button>
            </h5>
          </div>
          <div id="collapseThree" class="collapse" aria-labelledby="faqThree" data-parent="#customTourFaq">
            <div class="card-body">
              Absolutely! We'll work with you to refine the proposal until it perfectly matches your preferences and budget.
            </div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header" id="faqFour">            <h5 class="mb-0">
              <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour" aria-label="Toggle FAQ about cancellation policy">
                What if I need to cancel or change my custom tour after booking?
              </button>
            </h5>
          </div>
          <div id="collapseFour" class="collapse" aria-labelledby="faqFour" data-parent="#customTourFaq">
            <div class="card-body">
              Custom tours follow our standard cancellation policy. Changes can often be accommodated depending on how close they are to the departure date.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .custom-tour-container {
    padding-bottom: 60px;
  }

  .page-header {
    {% comment %} background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url({{ 'custom-tour-bg.jpg' | asset_url }}); {% endcomment %}
    background-size: cover;
    background-position: center;
    color: white;
    padding: 60px 0;
    margin-bottom: 40px;
    text-align: center;
  }

  .page-header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 20px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
  }

  .page-description {
    max-width: 800px;
    margin: 0 auto;
    font-size: 1.1rem;
    line-height: 1.6;
    background: linear-gradient(135deg, rgba(41, 128, 185, 0.85) 0%, rgba(52, 152, 219, 0.85) 100%);
    padding: 25px 30px;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    margin-top: 15px;
  }

  .page-description p {
    margin-bottom: 12px;
  }

  .page-description p:last-child {
    margin-bottom: 0;
  }

  .default-message {
    font-weight: 300;
    letter-spacing: 0.3px;
  }

  .custom-tour-form-container {
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 5px 30px rgba(0,0,0,0.1);
    padding: 40px;
    margin-bottom: 40px;
  }

  .form-section {
    margin-bottom: 30px;
    padding-bottom: 25px;
    border-bottom: 1px solid #eee;
  }

  .form-section:last-of-type {
    border-bottom: none;
  }

  .form-section h3 {
    font-size: 1.4rem;
    font-weight: 600;
    margin-bottom: 20px;
    color: #333;
  }

  .form-row {
    display: flex;
    flex-wrap: wrap;
    margin-right: -15px;
    margin-left: -15px;
  }

  .form-group {
    margin-bottom: 20px;
    width: 100%;
    padding-right: 15px;
    padding-left: 15px;
  }

  .col-md-6 {
    flex: 0 0 50%;
    max-width: 50%;
  }

  @media (max-width: 768px) {
    .col-md-6 {
      flex: 0 0 100%;
      max-width: 100%;
    }
    
    .custom-tour-form-container {
      padding: 25px;
    }
  }

  .form-control {
    display: block;
    width: 100%;
    padding: 12px 15px;
    font-size: 1rem;
    line-height: 1.5;
    color: #495057;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid #ced4da;
    border-radius: 6px;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
  }

  .form-control:focus {
    border-color: #449EED;
    outline: 0;
    box-shadow: 0 0 0 0.2rem rgba(68, 158, 237, 0.25);
  }

  label {
    display: inline-block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #333;
  }

  .required {
    color: #e74c3c;
  }

  .custom-control {
    position: relative;
    display: block;
    padding-left: 35px;
    cursor: pointer;
  }

  .custom-control-input {
    position: absolute;
    opacity: 0;
  }

  .custom-control-indicator {
    position: absolute;
    top: 0;
    left: 0;
    width: 22px;
    height: 22px;
    border: 1px solid #ccc;
    border-radius: 4px;
    background-color: #fff;
  }

  .custom-control-description {
    margin-left: 10px;
  }

  .custom-control-input:checked ~ .custom-control-indicator {
    background-color: #449EED;
    border-color: #449EED;
  }

  .custom-control-input:checked ~ .custom-control-indicator::before {
    content: "✓";
    color: white;
    position: absolute;
    top: -1px;
    left: 5px;
  }

  .form-actions {
    margin-top: 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .form-note {
    color: #777;
    font-size: 0.9rem;
    margin-bottom: 0;
  }

  .btn-primary {
    background-color: #449EED;
    border-color: #449EED;
    color: white;
    padding: 12px 24px;
    border-radius: 6px;
    font-weight: 500;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
  }

  .btn-primary:hover {
    background-color: #3080c5;
    border-color: #3080c5;
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(68, 158, 237, 0.3);
  }

  .btn-primary i {
    margin-right: 6px;
  }

  .alert {
    padding: 15px;
    border-radius: 6px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
  }

  .alert i {
    font-size: 20px;
    margin-right: 10px;
  }

  .alert-success {
    background-color: #d4edda;
    color: #155724;
  }

  .alert-danger {
    background-color: #f8d7da;
    color: #721c24;
  }

  .why-custom-tour {
    padding: 40px 0;
  }

  .features {
    margin-top: 40px;
  }

  .feature {
    text-align: center;
    padding: 0 20px 30px;
  }

  .feature-icon {
    font-size: 2.5rem;
    color: #449EED;
    margin-bottom: 15px;
  }

  .feature h4 {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 12px;
    color: #333;
  }

  .feature p {
    color: #666;
    line-height: 1.5;
  }

  .custom-tour-faq {
    padding: 40px 0;
  }

  .accordion .card {
    margin-bottom: 10px;
    border: 1px solid #e9ecef;
    border-radius: 6px !important;
    overflow: hidden;
  }

  .accordion .card-header {
    background-color: #f8f9fa;
    border-bottom: none;
    padding: 0;
  }

  .accordion .btn-link {
    display: block;
    width: 100%;
    text-align: left;
    color: #333;
    font-weight: 600;
    text-decoration: none;
    padding: 15px 20px;
    position: relative;
    transition: all 0.3s ease;
  }

  .accordion .btn-link:hover {
    background-color: #f1f1f1;
    color: #449EED;
  }

  .accordion .btn-link::after {
    content: "+";
    position: absolute;
    right: 20px;
    font-size: 20px;
    font-weight: 400;
  }

  .accordion .btn-link[aria-expanded="true"]::after {
    content: "−";
  }

  .accordion .card-body {
    padding: 15px 20px;
    color: #666;
    line-height: 1.6;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Pre-fill the form if query parameters are present
    const urlParams = new URLSearchParams(window.location.search);
    const destination = urlParams.get('destination');
    const date = urlParams.get('date');
    const duration = urlParams.get('duration');
    const travelers = urlParams.get('travelers');
    
    if (destination) document.getElementById('destination').value = destination;
    if (date) document.getElementById('start-date').value = date;
    if (duration) document.getElementById('duration').value = duration;
    if (travelers) document.getElementById('travelers').value = travelers;
    
    // Form validation
    const form = document.getElementById('customTourRequestForm');
    
    form.addEventListener('submit', function(event) {
      const requiredFields = form.querySelectorAll('[required]');
      let isValid = true;
      
      requiredFields.forEach(field => {
        if (!field.value.trim()) {
          isValid = false;
          field.classList.add('is-invalid');
        } else {
          field.classList.remove('is-invalid');
        }
      });
      
      if (!isValid) {
        event.preventDefault();
        
        // Create error message if not exists
        if (!document.querySelector('.form-error')) {
          const errorDiv = document.createElement('div');
          errorDiv.className = 'form-error alert alert-danger';
          errorDiv.innerHTML = '<i class="bi bi-exclamation-triangle-fill"></i><span>Please fill all required fields.</span>';
          form.prepend(errorDiv);
        }
        
        // Scroll to the first invalid field
        const firstInvalid = form.querySelector('.is-invalid');
        if (firstInvalid) {
          firstInvalid.focus();
          firstInvalid.scrollIntoView({behavior: 'smooth', block: 'center'});
        }
      }
    });
    
    // Clear validation styling on input
    form.querySelectorAll('.form-control').forEach(input => {
      input.addEventListener('input', function() {
        this.classList.remove('is-invalid');
      });
    });
    
    // Accordion functionality
    document.querySelectorAll('.btn-link').forEach(button => {
      button.addEventListener('click', function() {
        const expanded = this.getAttribute('aria-expanded') === 'true';
        this.setAttribute('aria-expanded', !expanded);
        
        const collapseId = this.getAttribute('data-target');
        const collapseElement = document.querySelector(collapseId);
        
        if (collapseElement) {
          if (expanded) {
            collapseElement.classList.remove('show');
          } else {
            collapseElement.classList.add('show');
          }
        }
      });
    });
  });
</script>